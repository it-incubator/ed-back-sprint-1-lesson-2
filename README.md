# Техническое задание на разработку API для управления транспортными средствами

## 1. Введение

Цель данного проекта — разработка RESTful API для управления поездками. API должен обеспечивать возможность создания,
получения и обновления информации о поездках.

## 2. Общие требования

- API должен поддерживать версию 1.0.0.
- Все запросы к API должны использовать базовую аутентификацию.
- Ответы API должны быть в формате JSON.

## 3. Логика приложения

### 3.1 Обновленные эндпоинты и их функциональность

В этой версии API необходимо добавить механизм базовой авторизации (Basic Authentication) для эндпоинтов. Это будет
включать:

- Проверку заголовка `Authorization` в запросах.
- Валидацию учетных данных (username и пароль). Данные username и пароль для админа задаются 'admin' и 'qwerty' и
  хранятся в переменных окружения.
- Обработку случаев, когда авторизация не удалась (например, возвращение статуса 401 Unauthorized).

- **GET /api/drivers**
    - Добавить в код: требуется базовая авторизация.

- **GET /api/drivers/{id}**
    - Добавить в код: требуется базовая авторизация.

- **POST /api/drivers**
    - Добавить в код: требуется базовая авторизация.

- **PUT /api/drivers/{id}**
    - Добавить в код: требуется базовая авторизация.

- **DELETE /api/drivers/{id}**
    - Добавить в код: требуется базовая авторизация.
    - Добавить проверку: если у водителя статус 'on-order' (те в данный момент есть заказ), то удалить водителя нельзя.

### 3.2 Новые эндпоинты и их функциональность

В данном разделе описываются новые эндпоинты, связанные с управлением поездками. Эти эндпоинты позволяют администраторам
эффективно управлять процессом заказа и отслеживания поездок. Основные функции приложения включают:

- **POST /api/rides - Создание поездки**:
    - Администратор может заказать новую поездку для клиента, указав информацию о клиенте, водителе
      и адресах начала и конца поездки. При создании поездки система автоматически назначает водителя (присваивается
      соответствующий статус 'on-ride') и транспортное средство.
    - Назначить поездку водителю со статусами 'on-ride' (т.е. водитель уже в рейсе) или 'offline' (т.е. водитель не в
      системе) нельзя.
    - Требуется базовая авторизация.

- **GET /api/rides - Получение списка всех поездок**:
    - Администратор может просматривать список всех активных и завершенных поездок, что позволяет отслеживать историю
      поездок и их статусы.
    - Требуется базовая авторизация.

- **GET /api/rides/{id} - Получение информации о поездке по ID**:
    - Администратор может получить детальную информацию о конкретной поездке,
      используя её уникальный идентификатор. Это включает данные о клиенте, водителе, стоимости и статусе поездки.
    - Требуется базовая авторизация.

## 4. Описание проекта

В данной версии проекта были внесены значительные изменения, направленные на улучшение его функциональности,
производительности и удобства использования. Ниже представлены ключевые изменения по сравнению с предыдущей версией, а
также преимущества выбранных стратегий.

- ### Замена ручной валидации на express-validator

В предыдущей версии проекта валидация входящих данных осуществлялась вручную, что увеличивало вероятность ошибок и
усложняло поддержку кода. В новой версии мы внедрили библиотеку express-validator, которая автоматизирует процесс
валидации. Для форматирования и вывода ошибок используется мидлвара inputValidationResultMiddleware, что позволяет
стандартизировать обработку ошибок и улучшить взаимодействие с клиентом.

**Плюсы**:

- Упрощение кода и уменьшение его объема.
- Повышение надежности валидации данных.
- Улучшение пользовательского опыта за счет четких и понятных сообщений об ошибках.
- Введение нового архитектурного слоя репозитория

- ### Использование хендлеров для обработки запросов:

В каждом роуте добавлены хендлеры (handlers) как конечные обработчики для каждого запроса.
Это функции, в которые выносится логика. Хендлеры созданы для каждого типа запроса (GET, POST, PUT и т.д.).

**Плюсы**:

- Четкое разделение логики обработки запросов и валидации данных, что улучшает читаемость и поддержку кода.
- Упрощение тестирования отдельных частей логики, так как каждая функция отвечает за конкретный аспект обработки
  запроса.
- Легкость в добавлении новой функциональности, так как новые хендлеры могут быть добавлены без изменения существующих.

- ### Добавлен архитектурный слой репозиторий

Данный слой изолирует логику работы с базой данных от роутов. Это позволяет роутам сосредоточиться на обработке запросов
и ответов, а вся логика взаимодействия с базой данных вынесена в отдельные модули.

**Плюсы**:

- Упрощение структуры кода и улучшение его читаемости.
- Легкость в тестировании и модификации логики работы с базой данных.
- Повышение гибкости и масштабируемости приложения.

- ### Реализована базовая авторизация

Базовая авторизация необходима для проверки учетных данных администратора. Это обеспечивает дополнительный уровень
безопасности и упрощает процесс аутентификации.

**Плюсы**:

- Упрощение процесса аутентификации и повышения безопасности.
- Легкость в интеграции с другими системами и сервисами.
- Улучшение управления доступом к ресурсам приложения.

- ### Добавление тестов для нового раздела поездок

В связи с внедрением новой логики управления поездками, в проект были добавлены тесты для проверки функциональности
этого раздела. В дополнение, повторяющиеся запросы были вынесены в утилитные функции, что позволяет избежать
дублирования
кода и улучшает его поддержку. Это позволяет гарантировать корректность работы новых эндпоинтов и их взаимодействия с
остальными частями системы.

**Плюсы**:

- Повышение надежности и стабильности приложения.
- Упрощение процесса выявления и исправления ошибок.
- Уверенность в том, что новые изменения не нарушают существующую функциональность.
- Упрощение поддержки и расширяемости тестов.

- ### Вынесение URL-адресов роутов в константы

В новой версии проекта все URL-адреса роутов были вынесены в константы. Это улучшает читаемость кода и упрощает его
поддержку, так как изменения в URL-адресах теперь можно вносить в одном месте.

**Плюсы**:

- Упрощение управления URL-адресами.
- Снижение вероятности ошибок при изменении адресов.
- Улучшение структурированности кода.

- ### Добавление проверки перед удалением/обновлением сущности

Перед выполнением операций удаления и обновления сущностей была добавлена проверка с помощью GET-запроса по ID. Это
позволяет убедиться в существовании сущности перед выполнением операции и убирает необходимость в проверках на уровне
репозитория.

**Плюсы**:

- Повышение надежности операций удаления и обновления.
- Упрощение логики на уровне репозитория.
- Улучшение обработки ошибок и информирование пользователей о несуществующих сущностях.

## 5. Заключение

Данное техническое задание описывает требования к обновлению и улучшению API для управления поездками в рамках проекта.
В нем представлены ключевые изменения, которые были внедрены в новой версии, включая автоматизацию валидации данных,
введение архитектурного слоя репозитория, реализацию базовой авторизации и добавление тестов для нового функционала.
Эти изменения направлены на повышение надежности, безопасности и удобства использования приложения, что создаст прочную
основу для дальнейшего развития и улучшения функциональности системы управления транспортными средствами.